## 概述

* 堆针对一个JVM进程来说是唯一的，也就是一个进程只有一个JVM，但是进程包含多个线程，他们是共享同一堆空间的。
* 一个JVM实例只存在一个堆内存，堆也是Java内存管理的核心区域。
* Java堆区在JVM启动的时候即被创建，其空间大小也就确定了。是JVM管理的最大一块内存空间。
* 《Java虚拟机规范》规定，堆可以处于<font color="orange">物理上不连续</font>的内存空间中，但在<font color="orange">逻辑上</font>它应该被视为<font color="orange">连续</font>的。
* <font color="orange">所有的线程共享Java堆，在这里还可以划分线程私有的缓冲区（Thread Local Allocation Buffer，TLAB）。</font>
* 《Java虚拟机规范》中对Java堆的描述是：（几乎？）所有的对象实例以及数组都应当在运行时分配在堆上。
* 数组和对象可能永远不会存储在栈上，因为栈帧中保存引用，这个引用指向对象或者数组在堆中的位置。
* 在方法结束后，堆中的对象不会马上被移除，仅仅在垃圾收集的时候才会被移除。
* 堆，是GC（Garbage Collection，垃圾收集器）执行垃圾回收的重点区域。

![image-20230425063020674](image/24.%E5%A0%86%E7%9A%84%E6%A6%82%E8%BF%B0/image-20230425063020674.png)



## 设置堆的大小

还是在运行调试里，vm选项

第一个参数是初始堆大小，第二个参数是最大堆大小

```java
-Xms20m -Xmx20m
```



## 查看堆空间

下载JVisualVM，具体的线程都在左边，双击打开就完事了

同时需要下载一个插件【tools】-【plugins】-【available plugins】-【找到Visual GC】-【install】

![image-20230425063402147](image/24.%E5%A0%86%E7%9A%84%E6%A6%82%E8%BF%B0/image-20230425063402147.png)

![image-20230425063411280](image/24.%E5%A0%86%E7%9A%84%E6%A6%82%E8%BF%B0/image-20230425063411280.png)



## 何时创建堆空间

在我们new一个对象或者是创建一个新的数组的时候，会开辟堆空间

![image-20230425063645256](image/24.%E5%A0%86%E7%9A%84%E6%A6%82%E8%BF%B0/image-20230425063645256.png)